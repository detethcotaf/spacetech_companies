<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/spacetech_companies/blog/rss.xml" title="自分用のメモを貯めておくサイト Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/spacetech_companies/blog/atom.xml" title="自分用のメモを貯めておくサイト Blog Atom Feed"><title data-react-helmet="true">Flow と cadence について | 自分用のメモを貯めておくサイト</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://detethcotaf.github.io/spacetech_companies/docs/blockchain/flow_cadence"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Flow と cadence について | 自分用のメモを貯めておくサイト"><meta data-react-helmet="true" name="description" content="cadence のプレイグラウンド"><meta data-react-helmet="true" property="og:description" content="cadence のプレイグラウンド"><link data-react-helmet="true" rel="shortcut icon" href="/spacetech_companies/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://detethcotaf.github.io/spacetech_companies/docs/blockchain/flow_cadence"><link data-react-helmet="true" rel="alternate" href="https://detethcotaf.github.io/spacetech_companies/docs/blockchain/flow_cadence" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://detethcotaf.github.io/spacetech_companies/docs/blockchain/flow_cadence" hreflang="x-default"><link rel="stylesheet" href="/spacetech_companies/assets/css/styles.032f44f0.css">
<link rel="preload" href="/spacetech_companies/assets/js/runtime~main.324ea705.js" as="script">
<link rel="preload" href="/spacetech_companies/assets/js/main.77ea08ed.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/spacetech_companies/"><img src="/spacetech_companies/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/spacetech_companies/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">SpaceDB</b></a><a class="navbar__item navbar__link navbar__link--active" href="/spacetech_companies/docs/home">Docs</a><a class="navbar__item navbar__link" href="/spacetech_companies/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/detethcotaf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/spacetech_companies/docs/home">Home</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">blockchain</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/spacetech_companies/docs/blockchain/blockchain_entry">ブロックチェーンの基本を理解する</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/spacetech_companies/docs/blockchain/flow_cadence">Flow と cadence について</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/spacetech_companies/docs/blockchain/ipfs">IPFS について</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/spacetech_companies/docs/blockchain/nft_entry">NFT の基本を理解する</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">space</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Flow と cadence について</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="cadence-のプレイグラウンド"></a>cadence のプレイグラウンド<a class="hash-link" href="#cadence-のプレイグラウンド" title="Direct link to heading">#</a></h2><p>スマートコントラクトを実際に書いて試せる Palyground を Flow 公式が用意している ↓</p><p><a href="https://play.onflow.org/local-project" target="_blank" rel="noopener noreferrer">https://play.onflow.org/local-project</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="cadence-の特徴"></a>cadence の特徴<a class="hash-link" href="#cadence-の特徴" title="Direct link to heading">#</a></h2><ul><li><p>強力な静的型付け言語</p><p>Swift や Kotlin、TypeScript など最近の構文を取り入れている</p></li><li><p>リソース指向プログラミング</p><p>リソースが一度に一箇所にしか存在できない、コピーできない、削除されない、といった特徴がある。これによってデジタルの所有権をモデリングしやすくなっている</p></li><li><p>関数とトランザクションの前後条件</p><p>関数とトランザクションの前後に条件を記述して、テストができる</p></li><li><p>更新可能</p><p>一定の条件下でコントラクトをアップデート可能</p></li><li><p>最小権限の原則</p></li></ul><p>オブジェクトへのアクセスは所有者と参照を持つものに制限される</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="理解しておくべき用語"></a>理解しておくべき用語<a class="hash-link" href="#理解しておくべき用語" title="Direct link to heading">#</a></h2><ul><li><p>アカウント</p><p>ユーザーが持っているアカウント情報。通常はウォレットに格納して利用できる。</p></li><li><p>コントラクト</p><p>cadence におけるコントラクトとは、各アカウントのストレージに格納されているインターフェース、構造体、リソース、データ（アカウントの状態）、利用できる関数をひとまとめにしたもの。</p></li><li><p>アセット</p></li><li><p>リソース</p></li><li><p>トランザクション</p><p>コントラクトをオンチェーンで実行した結果。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="アカウントの特徴"></a>アカウントの特徴<a class="hash-link" href="#アカウントの特徴" title="Direct link to heading">#</a></h2><p>Flow のアカウントは２つの領域に分かれている。</p><ul><li><p>コントラクト領域</p><ul><li>スマートコントラクトのプログラムを格納する領域</li><li>アカウントの所有者はここにコントラクトを保存し、更新できる</li><li>トランザクションはこの領域には直接アクセスできない</li><li>他のコントラクトから利用できるようインターフェースを定義している必要がある</li></ul></li><li><p>ファイルシステム</p><ul><li>アカウントが所有するオブジェクトとそのアクセスを制御できる capabilities（実行可能な関数の一覧）を格納できる</li><li>トランザクションによってアクセスできる</li><li>ファイルシステムの root として <code>storage</code> <code>private</code> <code>public</code>という３つのドメインだけ指定できる。<ul><li><code>storage</code>: 全てのオブジェクト（token や NFT など）を保存する。アカウントの所有者のみがアクセスできるようになっている</li><li><code>private</code>: アセットの capabilities（実行可能な関数の一覧）を保存する。capabilities の中の関数を使ってオブジェクトの参照などが可能になる。アカウントの所有者とアクセス権を持っている人だけがアクセスできる。</li><li><code>public</code>: ネットワーク内の誰もがアカウントの情報を参照できるような capabilities（実行可能な関数の一覧）を保存する。</li></ul></li></ul></li></ul><p><code>private</code>と<code>public</code>の関数を使ってトランザクションコードを作成し、<code>storage</code>へアクセスするイメージ。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="コントラクト"></a>コントラクト<a class="hash-link" href="#コントラクト" title="Direct link to heading">#</a></h2><p><a href="https://developers.flow.com/cadence/language/contracts" target="_blank" rel="noopener noreferrer">https://developers.flow.com/cadence/language/contracts</a></p><p>cadence におけるコントラクトとは、各アカウントのストレージに格納されているインターフェース、構造体、リソース、データ（アカウントの状態）、利用できる関数をひとまとめにしたもの。</p><p>コントラクトは、アカウントのオーナーが追加、更新、削除できる。</p><p>加えて、Authorized Accounts も <code>contracts</code>オブジェクトを使えば、追加、更新、削除できる。</p><p>コントラクトのサンプル：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pub contract HelloWorld {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Declare a stored state field in HelloWorld</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub let greeting: String</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Declare a function that can be called by anyone</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // who imports the contract</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fun hello(): String {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return self.greeting</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    init() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.greeting = &quot;Hello World!&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>各アカウントのコントラクトは、トランザクションや他のアカウントから <code>import</code>することによって利用できる。ただし、<code>pub</code>がついている変数や関数のみ。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import HelloWorld from 0x42</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">log(HelloWorld.hello())    // prints &quot;Hello World!&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">log(HelloWorld.greeting)   // prints &quot;Hello World!&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Invalid: Cannot call the init function after the contract has been created.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HelloWorld.init()    // Error</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>pub</code>以外にも細かくアクセス制御ができる。詳細は <a href="https://developers.flow.com/cadence/language/access-control" target="_blank" rel="noopener noreferrer">https://developers.flow.com/cadence/language/access-control</a> に記載されている。</p><p>pub / access(all) &gt; access(account) &gt; access(contract) &gt; private</p><p>の順にスコープが狭くなる</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="トランザクション"></a>トランザクション<a class="hash-link" href="#トランザクション" title="Direct link to heading">#</a></h2><p><a href="https://developers.flow.com/cadence/language/transactions" target="_blank" rel="noopener noreferrer">https://developers.flow.com/cadence/language/transactions</a></p><p>トランザクションとしてオンチェーンで実行させたいプログラム。取引に関係するアカウントのコントラクト（コード）を使ってプログラムが実装される。
このプログラムに対して秘密鍵による承認を実行することで、承認したアカウントのストレージへのアクセスを許可するという仕組み。承認者は authorizers や signers と呼ばれる。
例えばアカウント A とアカウント B で NFT の所有者を変更したい時には、アカウント A と B でトランザクションを承認(sign)する必要がある。</p><p>トランザクションコードの例：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import HelloWorld from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare(acct: AuthAccount) {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // In execute, we simply call the hello function</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // of the HelloWorld contract and log the returned String.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    execute {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(HelloWorld.hello())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      log(HelloWorld.greeting)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="リソース"></a>リソース<a class="hash-link" href="#リソース" title="Direct link to heading">#</a></h2><p>リソースは、構造体や Class に似ている cadence 独自の考え方。
違いはコピー不可な点。コピーができないことで、所有権を表現することに使える。</p><p>リソースは以下のルールに従うよう作られている。</p><ul><li>１つの場所にだけ存在できる（コピーして同時に複数の場所に存在することはできない）<ul><li>場所とは、アカウントのストレージや、関数実行中の変数の中、コントラクトのストレージフィールドなどを指す</li></ul></li><li>リソースはアクセスがあったときに確実にある場所から他の場所への移動しなければならない（アクセスがあったとき？？？）</li><li>リソースはスコープの外側には移動できない。どこかに保存するか、破壊するかを明示しなければならない。</li></ul><p>このルールに従うことで、コーディングミスによるリソースの紛失やリソースのコピーを防ぎ、所有権の主張ができる状態を生み出している。</p><p>Cadence では、リソース（≒ アセット）をアカウントのストレージに保存し、アセットの所有権をアカウントに直接結びつけている。トランザクションが稼働するマシンのストレージを使わないため、アカウント間で自由にアセットを転送できる。イーサリアムなどでは、所有権がスマートコントラクトに保存されるため、アセットの追跡のために全てのスマートコントラクト（つまりトランザクション）を検索する必要がある。</p><p>リソースの実装のためには、</p><ul><li><code>createXXX</code></li><li>Move operater <code>&lt;-</code></li><li><a href="https://developers.flow.com/cadence/language/accounts#account-storage-api" target="_blank" rel="noopener noreferrer">Account Storage API</a></li></ul><p>を使える必要がある。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pub contract HelloWorld {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Declare a resource that only includes one function.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub resource HelloAsset {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // A transaction can call this function to get the &quot;Hello, World!&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // message from the resource.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun hello(): String {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &quot;Hello, World!&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // We&#x27;re going to use the built-in create function to create a new instance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // of the HelloAsset resource</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // HelloAssetのインスタンス化</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fun createHelloAsset(): @HelloAsset {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &lt;-create HelloAsset()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    init() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(&quot;Hello Asset&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="createxxx"></a>createXXX<a class="hash-link" href="#createxxx" title="Direct link to heading">#</a></h3><p>コントラクトやリソース、構造体などの型定義の際には、その型をオブジェクトとして生み出したときに一度だけ実行できる処理<code>init</code>を持つことできる。
cadence では全ての型要素を初期化することを求めているため、型要素を持っているオブジェクトの場合は init にて初期化する実装が必要になる。</p><p>コントラクトはアカウントのストレージへの読み書きアクセスを <code>self.account</code> オブジェクトを使って実装できる。
このオブジェクトは <code>AuthAccount object</code>と呼ばれ、アカウントのストレージを操作するための関数にアクセスできる権限を持っている。</p><p>このリソースは定義されたスコープ内でのみインスタンス化できる。これは他の人がこの定義されたリソースをインスタンス化できないようにするための措置。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pub fun createHelloAsset(): @HelloAsset {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &lt;-create HelloAsset()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>@マークはそれがリソースオブジェクトであることを示している。</p><p>そして return の部分で、<code>create</code>を使って HelloAsset リソースをインスタンス化している。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="move-operater--"></a>Move operater <code>&lt;-</code><a class="hash-link" href="#move-operater--" title="Direct link to heading">#</a></h3><p><code>&lt;-</code>によってコピーではなく、「移動」を表現している。</p><p><code>&lt;-</code>は以下のときに利用される。</p><ul><li>リソースが初期化（インスタンス化）されるとき</li><li>リソースが別の変数に設定されるとき</li><li>リソースが関数の引数として渡されるとき</li><li>リソースが関数から返されるとき</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">var fist_resource: @HogeResource &lt;- create AnyResource()</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">var second_resource &lt;- first_resource</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>上記の例の場合、second_resource にリソースインスタンスが格納されたら、first_resource には何も入っていない状態になる。</p><p>→ その場合 first_resource は None になるわけではなく、そもそも first_resource は存在しないことになり、アクセスできなくなる</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="トランザクションでリソースを扱う"></a>トランザクションでリソースを扱う<a class="hash-link" href="#トランザクションでリソースを扱う" title="Direct link to heading">#</a></h3><ul><li><p>ユーザーがデプロイしたコントラクトはあくまで関数を定義しただけで、リソースを生成したわけではない</p></li><li><p>リソースの生成や移動はトランザクションで実装する必要がある</p></li><li><p>以下のコードでリソースを生成し、AuthAccount、つまり 0x01 に保存できる</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import HelloWorld from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  prepare(acct: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Assetを生成し、newHelloに格納 */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let newHello &lt;- HelloWorld.createHelloAsset()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* アカウントのストレージにnewHelloを移動する */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    acct.save&lt;@HelloWorld.HelloAsset&gt;(&lt;-newHello, to: /storage/HelloAssetTutorial)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  execute {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log(&quot;Saved Hello Resource to account.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>prepare について</p><ul><li>prepare では、トランザクションを秘密鍵で承認したアカウントのストレージにアクセスできる</li><li>AuthAccount オブジェクトを通じてそのアカウントに何をするかをコーディングする</li><li>上記では例えば、acct.save を使って、newHello というアセットを保存（移動）している</li><li>prepare では、capabilities が保存された <code>/private/</code>と<code>/public/</code>へのリンクを作ることもできる</li><li>capabilities には、そのアカウントに対して実行できる関数がコーディングされている</li></ul></li><li><p>リソースの移動について</p><ul><li>ここでは AuthAccount のメソッドを使ってリソースを移動している</li><li>使い方は <code>AuthAccount.save&lt;T&gt;(_ value: T, to: StoragePath)</code></li><li>詳細は、<a href="https://developers.flow.com/cadence/language/accounts#account-storage-api" target="_blank" rel="noopener noreferrer">account storage API</a>に記載されている</li><li>T はリソースオブジェクトの型を設定しないといけないため、ここでは newHello の型、つまり <code>@HelloWorld.HelloAsset</code> になる</li><li>指定した移動先にすでにデータが存在していたり、newHello にリソースが存在しない場合は、プログラムが止まるようになっている</li><li>そのためパスコンフリクトが置きないように、ユニークで明確なパス名を指定する必要がある</li></ul></li><li><p>アカウントに保存したリソースを読み込む</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import HelloWorld from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare(acct: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* ストレージからリソースを読み込み、helloResourceに移動する */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let helloResource &lt;- acct.load&lt;@HelloWorld.HelloAsset&gt;(from: /storage/HelloAssetTutorial)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* リソースのhelloメソッドを使ってみる</span></span><span class="token-line" style="color:#393A34"><span class="token plain">           この時、オプショナルチェイン（?）を使っており、値がloadできない場合はnilになる</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(helloResource?.hello()) // helloResourceがnilの場合はlogの結果もnilになる</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* helloResourceはOptionalなのでnilの可能性がある</span></span><span class="token-line" style="color:#393A34"><span class="token plain">           !を使うことで、値があればそのまま実行し、nilであればトランザクション自体を止めることができる</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        acct.save(&lt;-helloResource!, to: /storage/HelloAssetTutorial)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ストレージからリソースを取得した時には、その値は optional 型で return される。optional 型とは、元々の値の型と nil のどちらも保持した型を指す。
そのため、helloResource を使うときはオプショナルチェイン（?）を使って、helloResource を unwrap しないと hello()は使えない。
?をつけずに hello()を使おうとすると</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">value of type `HelloWorld.HelloAsset?` has no member `hello`. unknown member</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>というエラーが発生する。
なぜなら optional 型としては hello 関数を持っておらず、optional 型の中の HelloWorld.HelloAsset が hello 関数を持っているだけだから。</p><p>acct.save の時も同じく、helloResource の optional 型のまま save に引数として渡すと optional 型のままストレージに保存されてしまう。!を使って force-unwrap しないと元々の値をストレージに格納することにはならない。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="capability"></a>Capability<a class="hash-link" href="#capability" title="Direct link to heading">#</a></h2><ul><li><p>Capability とは</p><ul><li>アカウントのストレージにアクセスするには、そのアカウントの所有者から明示的に許可を取る必要がある</li><li>その許可は Capability という外部への公開 API のようなものを作ることで可能になる</li></ul></li><li><p>Capability の作り方</p><ul><li>link 関数を使いアカウントのリソースオブジェクトへのパブリックリンクを作成する</li><li>そしてそのリンクを使いリソースオブジェクトへの参照権限を一時的にもらい、hello()関数が呼び出せるようになる</li><li>ただし、リソースオブジェクトの移動や destroy、コピー、変更などはできない</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import HelloWorld from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  prepare(account: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* capabilityを生成</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       /public/にCapabilityを配置し、targetで対象のリソースを指定している</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       referenceを得るだけなので型で&amp;を利用している</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let capability = account.link&lt;&amp;HelloWorld.HelloAsset&gt;(/public/HelloAssetTutorial, target: /strorage/HelloAssetTutorial)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* borrowメソッドを使ってリソースへのリファレンスリンクを生成している</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let HelloReference = capability!.borrow()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      ?? panic(&quot;Could not borrow a reference to the hello capability&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* リソースのメソッドを使用</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log(helloReference.hello())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /* helloReferenceはトランザクションの最後に自動的に破棄されるため、明示的な操作は必要ない</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><p>capability の生成コードについて</p><ul><li>link を生成する時には、&amp;を使って型を指定している。これでポインタのように参照していることを示している。</li><li>ここでは HelloAsset の link を生成しているので、HelloAsset が持つオブジェクト全てにアクセスできるようになる。</li><li>なお、<code>account.link&lt;&amp;HelloWorld.HelloAsset&gt;</code>で指定した型は、リンク先のオブジェクトのサブタイプでなければならず、それ以外のフィールドや関数は含められない。</li></ul></li><li><p>borrow メソッドについて</p><ul><li>borrow()メソッドはリソースや Capability に対して利用できる</li><li>上記では force-unwrap と<code>??</code>によるチェインを使っている</li><li>これはストレージが空だったり、すでに borrow していたり、型が許可されているものを超えていた場合、<code>nil</code>になるため。</li><li>つまり、一度 borrow したら nil になるため、たとえば上記トランザクションコードの２回目の実行時には <code>Error &gt; unexpectedly found nil while forcing an Optional value</code> というエラーが発生する</li><li>このように一度 borrow した後は nil になる制約は、リエントランシー攻撃（reentrancy attacks）という攻撃手法を防ぐために作られている。</li><li>リエントランシー攻撃は一度のトランザクションで同じオブジェクトを複数回呼び出し悪意ある攻撃（たとえば何度もリソースを引き出す）をすること。上記の制約によりオブジェクトは一度のトランザクションで１つしか link できないため防ぐことができている。（という理解であっている？？）</li><li>リエントランシー攻撃については　[スマートコントラクトセキュリティ講座〜リエントランシー編〜Qiita]（<a href="https://qiita.com/Ogtsn99/items/559ffaed745af971856f%EF%BC%89" target="_blank" rel="noopener noreferrer">https://qiita.com/Ogtsn99/items/559ffaed745af971856f）</a> が分かりやすい。</li></ul></li><li><p>オブジェクトのオーナー側は link されているオブジェクトを移動したり、link を破壊したりできる。</p></li></ul></li><li><p>scripts を使って capability を利用する</p><ul><li>public 領域に生成された capability は誰でも使える</li><li>その capability を scripts を使って利用することができる</li><li>scripts とは<ul><li>ブロックチェーンへの書き込みはできず、アカウントやコントラクトの状態だけを読み取れる</li><li>アカウントの許可なく実行するため、signer などはいない</li></ul></li><li>scripts の例</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import HelloWorld from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fun main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /* PublicAccountオブジェクトを取得（※AuthAccountとは異なり、public領域にしかアクセスできない）</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let helloAccount = getAccount(0x01)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /* アカウントオブジェクトのgetCapabilityメソッドを使ってpublicのCapabilityを取得</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let helloCapability = helloAccount.getCapability&lt;&amp;HelloWorld.HelloAsset&gt;(/public/HelloAssetTutorial)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /* Capabilityをborrowし、リソースオブジェクトへのlinkを得る</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let helloReference = helloCapability.borrow()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      ?? panic(&quot;Could not borrow a reference to the hello capability&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /* リソースオブジェクトのメソッドを利用する</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  log(helloReference.hello())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>helloCapability.borrow()</code>は force-unwrap になっていないので optional 型ではない？ただの書き忘れ？</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="cadence-における-nft"></a>Cadence における NFT<a class="hash-link" href="#cadence-における-nft" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="概要"></a>概要<a class="hash-link" href="#概要" title="Direct link to heading">#</a></h3><ul><li><p>ユーザーは NFT を自分のアカウントに保存する（他の言語とは異なるところ）</p></li><li><p>NFT は型によって下記のリソース利用のルールが強制される</p><ul><li>リソースの所有者は 1 人だけ設定できる</li><li>事故や故意に関わらず複製できない</li><li>事故や故意に関わらず紛失できない</li></ul></li><li><p>上記のように NFT は自分のアカウントに保存され、リソース利用のルールが適用されることから、所有者は自分の NFT が安全であり、ユニークな所有者であることを証明できる</p></li><li><p>NFT は互換性があるため、発行元のアプリやスマートコントラクトとは異なるものでも利用できる</p><ul><li><a href="https://github.com/onflow/flow-nft" target="_blank" rel="noopener noreferrer">NFT Token Standard</a>として Flow 上の NFT のプロパティが定義されているため、互換性がある</li></ul></li><li><p>NFT は名前や画像などのメタデータを持っており、一般的には off-chain に格納される</p><ul><li>on-chain にはメタデータが格納されている URL が指定されていることが多い</li><li>ただし、Flow では全てのメタデータを on-chain に格納することを目指しているらしい</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="一般的な-nft-デプロイの流れ"></a>一般的な NFT デプロイの流れ<a class="hash-link" href="#一般的な-nft-デプロイの流れ" title="Direct link to heading">#</a></h3><ol><li>NFT のコントラクトとリソースタイプをデプロイ</li><li>NFT オブジェクトを生成しアカウントストレージに保存</li><li>NFT コレクションオブジェクトをアカウントに保存</li><li>NFT を mint</li><li>アカウントから別のアカウントへ token を送るためのコレクションの ref を生成</li><li>NFT を transfer</li><li>scripts を使って各アカウントにおける NFT の状況を確認</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="nft-の生成と移動"></a>NFT の生成と移動<a class="hash-link" href="#nft-の生成と移動" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pub contract BasicNFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* NFTのリソースタイプを定義 */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub resource NFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub let id: UInt64</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub var metadata: {String: String}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        init(initID: UInt64) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.id = initID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.metadata = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* NFTを作るためのメソッドをpublicに公開 */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fun createNFT(id: UInt64): @NFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &lt;-create NFT(initID: id)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* NFTをID:1で生成し、ストレージに保存</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       AuthAccountオブジェクトにアクセスしsaveメソッドを呼び出している */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    init() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.account.save&lt;@NFT&gt;(&lt;-create NFT(initID: 1), to: /storage/BasicNFTPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>NFT はそれぞれでユニークな ID を持たせる必要がある<ul><li>そのため、コントラクトで許可されていない限り、複製や統合はできない</li></ul></li><li>上記のコードをデプロイすることでデプロイしたアカウントのストレージに NFT が保存される</li><li>その NFT を transaction で borrow して存在していることを確認できる</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import BasicNFT from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare(acct: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if acct.borrow&lt;&amp;BasicNFT.NFT&gt;(from: /storage/BasicNFTPath) != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            log(&quot;The token exists!&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            log(&quot;No token found!&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>NFT を移動する<ul><li>transaction への署名者間で NFT の移動を実現できる</li><li>移動するときには AuthAccount オブジェクトの load()と save()メソッドを使う</li></ul></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import BasicNFT from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  prepare(signer1: AuthAccount, signer2: AuthAccount){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let nft &lt;- signer1.load&lt;@BasicNFT.NFT&gt;(from: /storage/BasicNFTPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          ?? panic(&quot;Could not load NFT&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signer2.save&lt;@BasicNFT.NFT&gt;(&lt;-nft, to: /storage/BasicNFTPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="nft-のコレクション"></a>NFT のコレクション<a class="hash-link" href="#nft-のコレクション" title="Direct link to heading">#</a></h3><ul><li><p>複数の NFT を１つずつ別々でパス管理するのは手間がかかる</p></li><li><p>NFT を束ねて管理するにはコレクションというオブジェクトを利用できる</p></li><li><p>コレクションとは
　- コレクションはリソースの Dictionaries という形</p><ul><li>辞書形式で複数の NFT を一括で管理することになり、全ての key, value が同じタイプである必要がある</li><li>NFT を格納した場合は、辞書自体もリソース型として扱うことになり、複製不可などのルールも適用される</li><li>例: <code>let myNFTs: @{Int: BasicNFT.NFT} = {}</code></li><li>つまり、リソースがリソースを内包する形になり、これは Cadence の特徴的な機能と言われている</li></ul></li><li><p>コレクションの生成（コメントとして説明も記載）</p></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pub contract ExampleNFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub let CollectionStoragePath: StoragePath</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub let CollectionPublicPath: PublicPath</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub let MinterStoragePath: StoragePath</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Tracks the unique IDs of the NFT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub var idCount: UInt64</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // NFTの型を定義、ここではメタデータなし</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub resource NFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub let id: UInt64</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        init(initID: UInt64) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.id = initID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // コレクションの所有者以外がコレクションを操作できるようにするためにinterfaceを定義</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // interfaceに含まれている関数のみを外部から利用できる（Capabilityをborrowする形で利用できる）</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub resource interface NFTReceiver {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun deposit(token: @NFT)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun getIDs(): [UInt64]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun idExists(id: UInt64): Bool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // コレクションの定義</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub resource Collection: NFTReceiver {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 辞書型として複数のNFTトークンを格納できる箱を用意</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub var ownedNFTs: @{UInt64: NFT}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // init()はCollectionリソース生成時に自動的に稼働する</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // init()内にてCollection内の全ての変数を初期化する必要がある</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 初期化していない変数がある場合は `missing initialization of field `XXX` in type `ExampleNFT.Collection`. not initialized` というエラーが発生する</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        init () {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.ownedNFTs &lt;- {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // withdraw</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // コレクションからNFTを取り出す関数</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun withdraw(withdrawID: UInt64): @NFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // If the NFT isn&#x27;t found, the transaction panics and reverts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            let token &lt;- self.ownedNFTs.remove(key: withdrawID)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ?? panic(&quot;Cannot withdraw the specified NFT ID&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &lt;-token</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // deposit</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // NFTをコレクションに格納する関数</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun deposit(token: @NFT) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // &lt;-! としているので、もし渡されたidにvalueが既に存在していたらfailしてrevertする</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.ownedNFTs[token.id] &lt;-! token</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 引数として指定したidのNFTが存在するかチェックする関数</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun idExists(id: UInt64): Bool {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return self.ownedNFTs[id] != nil</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // getIDsの結果は可変長の配列になるため、returnの型としては[]で要素の型を囲む記載になる</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        pub fun getIDs(): [UInt64] {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return self.ownedNFTs.keys // keys関数でDictionary型のkeyを全て取得できる</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // pubなしでdestroyを定義</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // コレクションを destroy するときにはその中身のリソースの扱いも定義しないといけない</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // リソースも destroy するか、別の場所に移動するか、の選択肢がある</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ここでは辞書ごとdestroyしている</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        destroy() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            destroy self.ownedNFTs</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // コレクションの初期化関数</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fun createEmptyCollection(): @Collection {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &lt;- create Collection()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // mintNFT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // idでNFTを生成（mint）し、idをインクリメント</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 通常、mintができるのはリソースの所有者だけにする</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ここでは実験のためにpubにしている</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fun mintNFT(): @NFT {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        var newNFT &lt;- create NFT(initID: self.idCount)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ここでインクリメントすることでNFTがmintされるたびにidが変わり重複がなくなる仕組み</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.idCount = self.idCount + 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &lt;-newNFT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ExampleNFTコントラクトをデプロイした時の初期化処理</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    init() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // パスの初期化</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.CollectionStoragePath = /storage/nftTutorialCollection</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.CollectionPublicPath = /public/nftTutorialCollection</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.MinterStoragePath = /storage/nftTutorialMinter</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // IDの初期化</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.idCount = 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // コレクションを初期化し、ストレージに格納</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.account.save(&lt;-self.createEmptyCollection(), to: self.CollectionStoragePath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Capabilityとしてreferenceをpublicストレージに配置</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.account.link&lt;&amp;{NFTReceiver}&gt;(self.CollectionPublicPath, target: self.CollectionStoragePath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><p>interface と pub の違い</p><ul><li>利用できる関数を interface で制限するんじゃなくて pub は外す、じゃだめなのか？<ul><li>interface に入っている関数は AuthAccount ではなくても実行できる（scripts などから利用できる）</li><li>入っていない関数はトランザクションで sign したアカウントだけが使える</li><li>一方で pub はコントラクトコード以外からでも関数を使えるようにするための接頭語</li><li>例えば withdraw を pub ではなく priv にすると、コントラクトのオーナーであってもトランザクションで withdraw を使えなくなる</li><li>その場合、<code>cannot access `withdraw`: function has private access</code>というエラーが発生する</li></ul></li></ul></li><li><p>生成したコレクションを使って NFT を生成（mint）</p><ul><li>通常、mint ができるのはリソースの所有者だけに絞る</li><li>ここでは実験のために mintNFT 関数を pub にしている</li><li>以下例ではその mintNFT を使って NFT を生成している</li></ul></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import ExampleNFT from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // NFTReceiverの型としてreveriverRefを定義</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let receiverRef: &amp;{ExampleNFT.NFTReceiver}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare(acct: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // getCapabilityしてborrowまでワンラインで実施</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 0x01以外のsignerだったらpanicになる</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.receiverRef = acct.getCapability&lt;&amp;{ExampleNFT.NFTReceiver}&gt;(ExampleNFT.CollectionPublicPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .borrow()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ?? panic(&quot;Could not borrow receiver reference&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    execute {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // mintNFTを使って新たなNFTを生成</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let newNFT &lt;- ExampleNFT.mintNFT()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // interfaceであるdepositを使ってコレクションに生成したNFTを移動する</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.receiverRef.deposit(token: &lt;-newNFT)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(&quot;NFT Minted and deposited to Account 1&#x27;s Collection&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>コレクションを scripts で確認<ul><li>Capability を使ってコレクションの情報を確認する</li></ul></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import ExampleNFT from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fun main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // public account objectを取得</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let nftOwner = getAccount(0x01)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Capabilityを取得</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let capability = nftOwner.getCapability&lt;&amp;{ExampleNFT.NFTReceiver}&gt;(ExampleNFT.CollectionPublicPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Capabilityからrefをborrowする</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let receiverRef = capability.borrow()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ?? panic(&quot;Could not borrow receiver reference&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log(&quot;Account 1 NFTs&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log(receiverRef.getIDs()) // IDを確認</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><p>コレクション内の NFT を移動</p><ul><li>コレクションをアカウントから別のアカウントのストレージに移動する</li><li>その場合は、まず送り先のアカウントでもコレクションの箱を持っている必要がある</li><li>以下のトランザクションを 0x02 のアカウントで sign し実行することでコレクションの箱を生成できる</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import ExampleNFT from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare(acct: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* コレクションをsignerのアカウントストレージで生成</span></span><span class="token-line" style="color:#393A34"><span class="token plain">         pubで公開しているためsignしているアカウントにて実行できる */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let collection &lt;- ExampleNFT.createEmptyCollection()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        acct.save&lt;@ExampleNFT.Collection&gt;(&lt;-collection, to: ExampleNFT.CollectionStoragePath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(&quot;Collection created for account 2&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* Capabilityを生成（refをpublicのストレージに配置 */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        acct.link&lt;&amp;{ExampleNFT.NFTReceiver}&gt;(ExampleNFT.CollectionPublicPath, target: ExampleNFT.CollectionStoragePath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(&quot;Capability created&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>その後、以下のトランザクションで NFT を移動できる</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cadence"><pre tabindex="0" class="prism-code language-cadence codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import ExampleNFT from 0x01</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let transferToken: @ExampleNFT.NFT</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare(acct: AuthAccount) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* NFTの所有者であってもCapabilityをborrowして関数を使えるようにする */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let collectionRef = acct.borrow&lt;&amp;ExampleNFT.Collection&gt;(from: ExampleNFT.CollectionStoragePath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ?? panic(&quot;Could not borrow a reference to the owner&#x27;s collection&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* interfaceに定義されていない関数であってもsignerであればwithdraw関数は利用できる */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.transferToken &lt;- collectionRef.withdraw(withdrawID: 1)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    execute {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let recipient = getAccount(0x02)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* 受け取る側のCapabilityをborrowし、depositでコレクションにNFTtokenを格納 */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let receiverRef = recipient.getCapability&lt;&amp;{ExampleNFT.NFTReceiver}&gt;(ExampleNFT.CollectionPublicPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .borrow()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ?? panic(&quot;Could not borrow receiver reference&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        receiverRef.deposit(token: &lt;-self.transferToken)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log(&quot;NFT ID 1 transferred from account 1 to account 2&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>ただし、NFT の所有者 0x01 で実行しないといけない</li><li>例えば 0x02 アカウントで実行しようとすると、withdraw の部分でエラーが発生する</li><li>エラー内容：<code>Error panic: Cannot withdraw the specified NFT ID</code></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="開発する時には"></a>開発する時には<a class="hash-link" href="#開発する時には" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="参考にできるソースコード"></a>参考にできるソースコード<a class="hash-link" href="#参考にできるソースコード" title="Direct link to heading">#</a></h3><ul><li><p>cadence で書かれた NFT マーケットプレイスのサンプルプロジェクト</p><p><a href="https://github.com/onflow/kitty-items" target="_blank" rel="noopener noreferrer">https://github.com/onflow/kitty-items</a></p><p>これをベースに自社サービス用にカスタマイズすれば OK なのかも</p></li><li><p>NBA Top Shot のコントラクトの実装</p><p><a href="https://github.com/dapperlabs/nba-smart-contracts" target="_blank" rel="noopener noreferrer">https://github.com/dapperlabs/nba-smart-contracts</a></p></li><li><p>FanTop のコントラクト部分</p><p><a href="https://github.com/mediadotech/smart-contracts" target="_blank" rel="noopener noreferrer">https://github.com/mediadotech/smart-contracts</a></p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="flow-の人がレビューしてくれる"></a>Flow の人がレビューしてくれる<a class="hash-link" href="#flow-の人がレビューしてくれる" title="Direct link to heading">#</a></h3><ul><li>自分で開発したスマートコントラクトは、最終的にセキュリティ上のリスクがないか Dapper Labs 社の Flow チームが直々にチェックしてくれる</li><li>レビューの過程では、それぞれの定義の要件やどのように設計したのかを文面で確認されるそう</li><li>最終的に OK になれば、Flow の人がメインネットにデプロイしてくれる</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="テストネット"></a>テストネット<a class="hash-link" href="#テストネット" title="Direct link to heading">#</a></h3><ul><li>Flow のテストネット：<a href="https://docs.onflow.org/concepts/accessing-testnet/" target="_blank" rel="noopener noreferrer">https://docs.onflow.org/concepts/accessing-testnet/</a></li></ul><header><h1>参考</h1></header><ul><li><a href="https://techdo.mediado.jp/entry/2022/05/11/150000" target="_blank" rel="noopener noreferrer">Flow ブロックチェーンと Cadence 言語の実用 ― FanTop の裏側</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/detethcotaf/spacetech_companies/tree/main/docs/blockchain/flow_cadence.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/spacetech_companies/docs/blockchain/blockchain_entry"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« ブロックチェーンの基本を理解する</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/spacetech_companies/docs/blockchain/ipfs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">IPFS について »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cadence-のプレイグラウンド" class="table-of-contents__link">cadence のプレイグラウンド</a></li><li><a href="#cadence-の特徴" class="table-of-contents__link">cadence の特徴</a></li><li><a href="#理解しておくべき用語" class="table-of-contents__link">理解しておくべき用語</a></li><li><a href="#アカウントの特徴" class="table-of-contents__link">アカウントの特徴</a></li><li><a href="#コントラクト" class="table-of-contents__link">コントラクト</a></li><li><a href="#トランザクション" class="table-of-contents__link">トランザクション</a></li><li><a href="#リソース" class="table-of-contents__link">リソース</a><ul><li><a href="#createxxx" class="table-of-contents__link">createXXX</a></li><li><a href="#move-operater--" class="table-of-contents__link">Move operater <code>&lt;-</code></a></li><li><a href="#トランザクションでリソースを扱う" class="table-of-contents__link">トランザクションでリソースを扱う</a></li></ul></li><li><a href="#capability" class="table-of-contents__link">Capability</a></li><li><a href="#cadence-における-nft" class="table-of-contents__link">Cadence における NFT</a><ul><li><a href="#概要" class="table-of-contents__link">概要</a></li><li><a href="#一般的な-nft-デプロイの流れ" class="table-of-contents__link">一般的な NFT デプロイの流れ</a></li><li><a href="#nft-の生成と移動" class="table-of-contents__link">NFT の生成と移動</a></li><li><a href="#nft-のコレクション" class="table-of-contents__link">NFT のコレクション</a></li></ul></li><li><a href="#開発する時には" class="table-of-contents__link">開発する時には</a><ul><li><a href="#参考にできるソースコード" class="table-of-contents__link">参考にできるソースコード</a></li><li><a href="#flow-の人がレビューしてくれる" class="table-of-contents__link">Flow の人がレビューしてくれる</a></li><li><a href="#テストネット" class="table-of-contents__link">テストネット</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/spacetech_companies/docs/home">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/shun25533233" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/spacetech_companies/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/detethcotaf/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/spacetech_companies/assets/js/runtime~main.324ea705.js"></script>
<script src="/spacetech_companies/assets/js/main.77ea08ed.js"></script>
</body>
</html>